<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
 * Metadata - jQuery countdown plugin
 * http://alexmuz.ru/jquery-countdown/
 *
 * Copyright (c) 2009 Alexander Muzychenko
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */

$.fn.countdown = function (date, options) {
	options = $.extend({
		lang: {
			years:   ['year', 'years'],
			months:  ['month', 'months'],
			days:    ['day', 'days'],
			hours:   ['hour', 'hours'],
			minutes: ['minute', 'minutes'],
			seconds: ['second', 'seconds'],
			plurar:  function(n) {
				return (n == 1 ? 0 : 1);
			}
		},
		prefix: &quot;&quot;,
		display: &quot;full&quot;, // full | compact
		finish: null
	}, options);

	var timeDifference = function(begin, end) {
		if (end.getTime() &lt; begin.getTime()) {
			return false;
		}
		if (options.display == &quot;full&quot;) {
			var diff = [
				[&quot;seconds&quot;, end.getSeconds() - begin.getSeconds(), 60],
				[&quot;minutes&quot;, end.getMinutes() - begin.getMinutes(), 60],
				[&quot;hours&quot;, end.getHours() - begin.getHours(), 24],
				[&quot;days&quot;, end.getDate() - begin.getDate(), new Date(begin.getFullYear(), begin.getMonth() + 1, 0).getDate()],
				[&quot;months&quot;, end.getMonth() - begin.getMonth(), 12],
				[&quot;years&quot;, end.getFullYear() - begin.getFullYear(), 0]
			];
			var result = [];
			var flag = false;
			$.each(diff, function(i, a) {
				if (flag) {
					a[1]--;
					flag = false;
				}
				if (a[1] &lt; 0) {
					flag = true;
					a[1] += a[2];
				}
				if (!a[1] &amp;&amp; a[0] != &quot;seconds&quot;) return;
				result.push(a[1] + ' ' + options.lang[a[0]][options.lang.plurar(a[1])]);
			});
			return result.reverse().join(' ');
		} else {
			var diff = Math.floor((end.getTime() - begin.getTime()) / 1000);
			var dayDiff = Math.floor(diff / 86400);
			var when = &quot;&quot;;
			var display = function(diff, period) {
				return diff + &quot; &quot; + period + (diff == 1 ? &quot;&quot; : &quot;s&quot;);
			};
			if (diff &lt; 60) {
				when = display(diff, &quot;second&quot;);
			} else if (diff &lt; 60 * 60) {
				diff = Math.floor(diff / 60);
				when = display(diff, &quot;minute&quot;);
			} else if (diff &lt; 60 * 60 * 24) {
				diff = Math.floor(diff / (60 * 60));
				when = display(diff, &quot;hour&quot;);
			} else if (dayDiff &lt; 30) {
				when = display(dayDiff, &quot;day&quot;);
			} else if (dayDiff &lt; 365) {
				diff =  Math.floor(dayDiff / 31);
				when = display(diff, &quot;month&quot;);
			} else {
				when = &quot;more than year&quot;;
			}
			return when;
		}
	};
	var elem = $(this);
	var timeUpdate = function () {
		var s = timeDifference(new Date, date);
		if (s.length) {
			elem.html(options.prefix + s);
		} else {
			options.finish &amp;&amp; options.finish();
			clearInterval(timer);
		}
	};
	timeUpdate();
	var timer = setInterval(timeUpdate, 1000);
};
</pre>
</body>
</html>
