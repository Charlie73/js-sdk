<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">// vim: set ts=8 sts=8 sw=8 noet:
/*
 * Copyright (c) 2006-2011 Echo &lt;solutions@aboutecho.com&gt;. All rights reserved.
 * You may copy and modify this script as long as the above copyright notice,
 * this condition and the following disclaimer is left intact.
 * This software is provided by the author &quot;AS IS&quot; and no warranties are
 * implied, including fitness for a particular purpose. In no event shall
 * the author be liable for any damages arising in any way out of the use
 * of this software, even if advised of the possibility of such damage.
 */
/*
 *  jQuery autoResize (textarea auto-resizer)
 *  @copyright James Padolsey http://james.padolsey.com
 *  @version 1.04
 */

(function(a){a.fn.autoResize=function(j){var b=a.extend({onResize:function(){},animate:true,animateDuration:150,animateCallback:function(){},extraSpace:20,limit:1000},j);this.filter('textarea').each(function(){var c=a(this).css({resize:'none','overflow-y':'hidden'}),k=c.height(),f=(function(){var l=['height','width','lineHeight','textDecoration','letterSpacing'],h={};a.each(l,function(d,e){h[e]=c.css(e)});return c.clone().removeAttr('id').removeAttr('name').css({position:'absolute',top:0,left:-9999}).css(h).attr('tabIndex','-1').insertBefore(c)})(),i=null,g=function(){f.height(0).val(a(this).val()).scrollTop(10000);var d=Math.max(f.scrollTop(),k)+b.extraSpace,e=a(this).add(f);if(i===d){return}i=d;if(d&gt;=b.limit){a(this).css('overflow-y','');return}b.onResize.call(this);b.animate&amp;&amp;c.css('display')==='block'?e.stop().animate({height:d},b.animateDuration,b.animateCallback):e.height(d)};c.unbind('.dynSiz').bind('keyup.dynSiz',g).bind('keydown.dynSiz',g).bind('change.dynSiz',g)});return this}})(jQuery);

var plugin = Echo.Plugin.manifest(&quot;SubmitTextareaAutoResize&quot;, &quot;Echo.StreamServer.Controls.Submit&quot;);

plugin.init = function() {
	var self = this;
	var component = this.component;
	component.addPostValidator(function() {
		var valid = true;
		$.each([&quot;text&quot;], function (i, field) {
			valid = !self._highlightMandatory(component.dom.get(field));
			return valid;
		});
		return valid;
	});
};

plugin.component.renderers.postButton = function(element) {
	return this.parentRenderer(&quot;postButton&quot;, arguments).addClass(this.cssPrefix + &quot;btn btn btn-small&quot;);
};

plugin.component.renderers.body = function(element) {
	return this.parentRenderer(&quot;body&quot;, arguments).addClass(this.cssPrefix + &quot;content&quot;);
};

plugin.methods._highlightMandatory = function(element) {
	var component = this.component;
	var result = component.highlightMandatory(element);
	if (result) {
		var css = this.cssPrefix + &quot;mandatory&quot;;
		element.addClass(css)
			.one(&quot;focus&quot;, function() {
				element.removeClass(css);
			});
	}
	return result;
};

plugin.component.renderers.text = function(element) {
	if (this.config.get(&quot;mode&quot;) != &quot;compact&quot;) {
		element.one({
			&quot;focus&quot; : function() {
				$(this).autoResize( { extraSpace: 0 } );
			}
		});
	}
	return this.parentRenderer(&quot;text&quot;, arguments).addClass(this.cssPrefix + &quot;border&quot;);
};

plugin.css =
	'.{plugin.class:border} { border: 1px solid #CCCCCC; padding: 4px; }' +
	'.{plugin.class:btn} div.echo-label { font-size: 12px; }' +
	'.{plugin.class:content} .{class:content} { background-color: transparent; }' +
	'.{plugin.class:content} .{class:border} { border: none; }' +
	'.{plugin.class:mandatory} { border-color: #ff5050; }';

Echo.Plugin.create(plugin);

</pre>
</body>
</html>
